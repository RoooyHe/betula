# åŠ¨æ€æ ‡ç­¾ç®¡ç†åŠŸèƒ½ - æœ€ç»ˆå®ç°

## âœ… **åŠŸèƒ½æ¦‚è¿°**

æˆåŠŸå®ç°äº†åŠ¨æ€æ ‡ç­¾ç®¡ç†åŠŸèƒ½ï¼Œæ›¿æ¢äº†é¢„å®šä¹‰æ ‡ç­¾ç³»ç»Ÿï¼š

### ğŸ¯ **æ ¸å¿ƒåŠŸèƒ½**
- **åŠ¨æ€è·å–æ ‡ç­¾**ï¼šä»åç«¯APIè·å–æ‰€æœ‰å¯ç”¨æ ‡ç­¾
- **æ–°å¢æ ‡ç­¾åŠŸèƒ½**ï¼šç”¨æˆ·å¯ä»¥åˆ›å»ºæ–°çš„æ ‡ç­¾
- **è¾“å…¥æ¡†æ§åˆ¶**ï¼šæŒ‰é’®æ§åˆ¶è¾“å…¥æ¡†æ˜¾ç¤º/éšè—
- **å®æ—¶æ›´æ–°**ï¼šåˆ›å»ºæ ‡ç­¾åè‡ªåŠ¨åˆ·æ–°æ ‡ç­¾åˆ—è¡¨
- **æ ‡ç­¾é€‰æ‹©**ï¼šç‚¹å‡»æ ‡ç­¾æ·»åŠ åˆ°å¡ç‰‡

## ğŸ”§ **æŠ€æœ¯å®ç°**

### 1. **åç«¯APIé›†æˆ**

#### è·å–å…¨éƒ¨æ ‡ç­¾
```
GET /api/v1/tag
```
- è¿”å›æ‰€æœ‰æ ‡ç­¾çš„åˆ—è¡¨
- åŒ…å«IDã€æ ‡é¢˜ã€é¢œè‰²ä¿¡æ¯

#### åˆ›å»ºæ–°æ ‡ç­¾
```
POST /api/v1/tag
{
  "title": "æ ‡ç­¾åç§°",
  "color": "#é¢œè‰²å€¼"
}
```
- è‡ªåŠ¨ç”Ÿæˆéšæœºé¢œè‰²
- è¿”å›åˆ›å»ºçš„æ ‡ç­¾ä¿¡æ¯

### 2. **å‰ç«¯æ•°æ®ç»“æ„**

#### æ–°å¢DTO
```rust
#[derive(Serialize, Debug)]
pub struct CreateTagRequest {
    pub title: String,
    pub color: String,
}
```

#### StateçŠ¶æ€æ‰©å±•
```rust
// æ–°å¢æ ‡ç­¾ç›¸å…³çŠ¶æ€
pub new_tag_input: String,
pub show_new_tag_input: bool,
pub create_tag_signal: SignalToUI,
pub create_tag_rx: Option<Receiver<bool>>,
pub pending_create_tag: Option<String>,
```

### 3. **UIç•Œé¢è®¾è®¡**

#### åŠ¨æ€æ ‡ç­¾åŒºåŸŸ
```rust
// åŠ¨æ€æ ‡ç­¾åˆ—è¡¨åŒºåŸŸï¼ˆé¢„ç•™ç»™æœªæ¥PortalListå®ç°ï¼‰
existing_tags = <View> {
    width: Fill,
    height: Fit,
    flow: Down,
    spacing: 3,
}

// æ–°å¢æ ‡ç­¾åŒºåŸŸ
<View> {
    // æ–°å¢æŒ‰é’®
    new_tag_button = <Button> { text: "æ–°å¢" }
    
    // è¾“å…¥æ¡†å®¹å™¨ï¼ˆæ§åˆ¶æ˜¾ç¤º/éšè—ï¼‰
    new_tag_input_container = <View> {
        visible: false,
        new_tag_input = <TextInput> { ... }
    }
}
```

### 4. **APIæœåŠ¡å±‚**

#### è·å–å…¨éƒ¨æ ‡ç­¾
```rust
pub fn fetch_all_tags(tx: Sender<Vec<TagDto>>, signal: SignalToUI) {
    // å¼‚æ­¥è¯·æ±‚ GET /api/v1/tag
    // è§£æJSONå“åº”ä¸ºVec<TagDto>
    // é€šè¿‡channelå‘é€ç»“æœ
}
```

#### åˆ›å»ºæ ‡ç­¾
```rust
pub fn create_tag(title: String, tx: Sender<bool>, signal: SignalToUI) {
    // ç”Ÿæˆéšæœºé¢œè‰²
    let colors = vec!["#9FE7B4FF", "#61BD4FFF", "#FF6B6BFF", ...];
    let color = colors[title.len() % colors.len()];
    
    // æ„é€ CreateTagRequest
    // å‘é€POSTè¯·æ±‚åˆ° /api/v1/tag
    // è¿”å›æˆåŠŸ/å¤±è´¥çŠ¶æ€
}
```

### 5. **äº‹ä»¶å¤„ç†æµç¨‹**

#### æ‰“å¼€æ ‡ç­¾ç®¡ç†
1. ç”¨æˆ·ç‚¹å‡»å¡ç‰‡"è¯¦æƒ…"æŒ‰é’®
2. è°ƒç”¨`fetch_card_detail()`è·å–å¡ç‰‡ä¿¡æ¯
3. åŒæ—¶è°ƒç”¨`fetch_all_tags()`è·å–æ ‡ç­¾åˆ—è¡¨
4. æ˜¾ç¤ºæ¨¡æ€æ¡†å’Œæ ‡ç­¾ç®¡ç†ç•Œé¢

#### æ–°å¢æ ‡ç­¾
1. ç”¨æˆ·ç‚¹å‡»"æ–°å¢"æŒ‰é’®
2. æ˜¾ç¤º/éšè—è¾“å…¥æ¡†å®¹å™¨
3. ç”¨æˆ·è¾“å…¥æ ‡ç­¾åç§°
4. æŒ‰å›è½¦é”®è§¦å‘åˆ›å»º
5. è°ƒç”¨`create_new_tag()`
6. APIåˆ›å»ºæˆåŠŸååˆ·æ–°æ ‡ç­¾åˆ—è¡¨

#### ä¿¡å·å¤„ç†é“¾
```rust
Event::Signal => {
    self.handle_space_signal(cx);
    self.handle_create_space_signal(cx);
    self.handle_card_signal(cx);
    self.handle_space_update_signal(cx);
    self.handle_card_update_signal(cx);
    self.handle_card_detail_signal(cx);
    self.handle_tags_signal(cx);           // æ ‡ç­¾è·å–
    self.handle_card_tags_update_signal(cx); // æ ‡ç­¾æ›´æ–°
    self.handle_create_tag_signal(cx);     // æ ‡ç­¾åˆ›å»º
}
```

## ğŸ“Š **è¿è¡ŒéªŒè¯**

ä»è¿è¡Œæ—¥å¿—å¯ä»¥ç¡®è®¤ï¼š

### âœ… **APIè°ƒç”¨æˆåŠŸ**
```
API: è¯·æ±‚å…¨éƒ¨æ ‡ç­¾ URL: http://localhost:8911/api/v1/tag
API: å…¨éƒ¨æ ‡ç­¾å“åº”çŠ¶æ€: 200 OK
API: æˆåŠŸè·å– 2 ä¸ªæ ‡ç­¾
```

### âœ… **æ ‡ç­¾æ•°æ®æ­£ç¡®**
```
handle_tags_signal: æ ‡ç­¾æ•°æ®å·²æ›´æ–°ï¼Œå…± 2 ä¸ªæ ‡ç­¾
  - æ ‡ç­¾: éç´§æ€¥ (ID: 1, é¢œè‰²: None)
  - æ ‡ç­¾: ç´§æ€¥ (ID: 2, é¢œè‰²: None)
```

### âœ… **UIäº¤äº’æ­£å¸¸**
```
ç‚¹å‡»æ·»åŠ æ ‡ç­¾æŒ‰é’®
```

## ğŸ¯ **ç”¨æˆ·äº¤äº’æµç¨‹**

1. **æŸ¥çœ‹æ ‡ç­¾**ï¼š
   - ç‚¹å‡»å¡ç‰‡"è¯¦æƒ…"æŒ‰é’®
   - æ¨¡æ€æ¡†æ˜¾ç¤ºå½“å‰å¡ç‰‡æ ‡ç­¾
   - è‡ªåŠ¨åŠ è½½æ‰€æœ‰å¯ç”¨æ ‡ç­¾

2. **æ·»åŠ ç°æœ‰æ ‡ç­¾**ï¼š
   - ç‚¹å‡»"æ·»åŠ æ ‡ç­¾"æŒ‰é’®
   - æ˜¾ç¤ºæ ‡ç­¾ä¸‹æ‹‰æ¡†
   - ç‚¹å‡»é€‰æ‹©æ ‡ç­¾ï¼ˆå¾…å®ç°åŠ¨æ€æ¸²æŸ“ï¼‰

3. **åˆ›å»ºæ–°æ ‡ç­¾**ï¼š
   - ç‚¹å‡»"æ–°å¢"æŒ‰é’®
   - æ˜¾ç¤ºè¾“å…¥æ¡†
   - è¾“å…¥æ ‡ç­¾åç§°
   - æŒ‰å›è½¦é”®åˆ›å»º
   - è‡ªåŠ¨åˆ·æ–°æ ‡ç­¾åˆ—è¡¨

## ğŸ”„ **å®Œæ•´æ•°æ®æµ**

```
ç”¨æˆ·ç‚¹å‡»"è¯¦æƒ…" 
    â†“
fetch_card_detail() + fetch_all_tags()
    â†“
æ˜¾ç¤ºæ¨¡æ€æ¡† + åŠ¨æ€æ ‡ç­¾åˆ—è¡¨
    â†“
ç”¨æˆ·ç‚¹å‡»"æ–°å¢"æŒ‰é’®
    â†“
æ˜¾ç¤ºè¾“å…¥æ¡†
    â†“
ç”¨æˆ·è¾“å…¥æ ‡ç­¾åç§° + å›è½¦
    â†“
create_new_tag() APIè°ƒç”¨
    â†“
åˆ·æ–°æ ‡ç­¾åˆ—è¡¨
```

## ğŸš€ **ä¸‹ä¸€æ­¥ä¼˜åŒ–**

### å¾…å®ç°åŠŸèƒ½
1. **åŠ¨æ€æ ‡ç­¾æ¸²æŸ“**ï¼šä½¿ç”¨PortalListåŠ¨æ€æ¸²æŸ“existing_tagsåŒºåŸŸ
2. **æ ‡ç­¾ç‚¹å‡»é€‰æ‹©**ï¼šä¸ºåŠ¨æ€æ ‡ç­¾æŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶
3. **é¢œè‰²æ˜¾ç¤º**ï¼šåœ¨æ ‡ç­¾æŒ‰é’®ä¸­æ˜¾ç¤ºå¯¹åº”é¢œè‰²
4. **æ ‡ç­¾åˆ é™¤**ï¼šæ·»åŠ åˆ é™¤æ ‡ç­¾åŠŸèƒ½

### æŠ€æœ¯æ”¹è¿›
1. **PortalListé›†æˆ**ï¼šå°†existing_tagsæ”¹ä¸ºPortalListå®ç°
2. **çŠ¶æ€ä¼˜åŒ–**ï¼šä¼˜åŒ–æ ‡ç­¾çŠ¶æ€ç®¡ç†
3. **UIç¾åŒ–**ï¼šæ”¹è¿›æ ‡ç­¾æŒ‰é’®æ ·å¼å’Œå¸ƒå±€

## âœ… **å½“å‰çŠ¶æ€**

- ğŸŸ¢ **ç¼–è¯‘æˆåŠŸ**ï¼šæ— è¯­æ³•é”™è¯¯
- ğŸŸ¢ **APIé›†æˆ**ï¼šæ ‡ç­¾è·å–å’Œåˆ›å»ºAPIæ­£å¸¸å·¥ä½œ
- ğŸŸ¢ **UIäº¤äº’**ï¼šæŒ‰é’®ç‚¹å‡»å’Œè¾“å…¥æ¡†æ˜¾ç¤ºæ­£å¸¸
- ğŸŸ¢ **æ•°æ®æµ**ï¼šä¿¡å·å¤„ç†å’ŒçŠ¶æ€ç®¡ç†å®Œæ•´
- ğŸŸ¡ **åŠ¨æ€æ¸²æŸ“**ï¼šexisting_tagsåŒºåŸŸå¾…å®ç°PortalList

**çŠ¶æ€**: ğŸŸ¢ **æ ¸å¿ƒåŠŸèƒ½å®Œæˆï¼Œå¯ç”¨äºåˆ›å»ºå’Œç®¡ç†æ ‡ç­¾**